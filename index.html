<!DOCTYPE html>
<html lang='en'>
 <head>
  <title>Basic HTML5 document</title>
  <meta charset='utf-8'>
  <style>
  </style>
 </head>
 <body>
   <canvas id="canvas" width="500", height="500"></canvas>
 </body>
 <script>
const squares = 20; // number of squares
const rate = 1.5; // seconds per example
const timer = 300; // length of game in seconds

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function loadImage(url) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => {
      resolve(img);
    }
    img.src = url;
  });
}

function update(img, chance) {
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  for (let x = 0; x < squares; x++) {
    for (let y = 0; y < squares; y++) {
      if (Math.random() > chance) {
        ctx.fillStyle = 'white';
        ctx.fillRect(x * canvas.width / squares,
                     y * canvas.height / squares,
                     canvas.width / squares,
                     canvas.height / squares);
      }
    }
  }
}

/*
function startGame(img) {
  let alpha = 1;
  function drawFrame() {
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    alpha -= 0.005;
    if (alpha >= 0) {
      window.requestAnimationFrame(drawFrame);
    }
  }
  window.requestAnimationFrame(drawFrame);
}
*/

loadImage('https://i.guim.co.uk/img/media/26392d05302e02f7bf4eb143bb84c8097d09144b/446_167_3683_2210/master/3683.jpg?width=1200&height=1200&quality=85&auto=format&fit=crop&s=49ed3252c0b2ffb49cf8b508892e452d')
  .then((img) => {
    // startGame(img);

    let chance = 0;
    setInterval(() => {
      update(img, chance);
      chance += (rate / timer);
    }, rate * 1000);
  });
 </script>
</html>
